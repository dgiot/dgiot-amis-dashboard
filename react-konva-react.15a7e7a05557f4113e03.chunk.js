/*!
 * build: 杭州数蛙科技有限公司 
 *  copyright: dgiot 
 *  project : dgiot_amis 
 *  version : 0.0.2 
 *  description : dgiot_amis 脚手架 
 *  author: h7ml(h7ml@qq.com) 
 *  time:Fri Apr 01 2022 07:22:40 GMT+0000 (Coordinated Universal Time)
 */
(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{1:function(t,e){},2:function(t,e){},3:function(t,e){},4:function(t,e){},"la/R":function(t,e,n){"use strict";n.d(e,"b",(function(){return i})),n.d(e,"a",(function(){return o}));var o="http://prod.iotn2n.com",i=location.origin},rmrB:function(t,e,n){"use strict";n.r(e);var o=n("+EbZ"),i=n.n(o),a=n("06Pm"),r=n.n(a),c=n("kA7L"),s=n.n(c),l=n("X5/F"),u=n.n(l),d=n("3SUL"),h=n.n(d),b=n("eYnF"),f=n.n(b),p=(n("07d7"),n("5s+n"),n("p532"),n("SLhn")),v=n.n(p),k=n("cDcd"),m=n.n(k),y=n("Exp3"),g=n("4Iue"),w=n("la/R"),q=n("Ni3L"),x=(n("rB9j"),n("EnZy"),n("FZtP"),n("kZKX")),I=n.n(x),S=n("5/y7"),P=function(){function t(e,n){r()(this,t),this.mqclient=void 0,this.brokerHost=void 0,this.brokerPort=void 0,this.subscribeTopics=void 0,this.subscribeCallbacks=void 0,this.brokerHost=e,this.brokerPort=n,this.subscribeTopics=new Array,this.subscribeCallbacks=new I.a}return s()(t,[{key:"subscribe",value:function(t,e){this.subscribeTopics.push({topic:t,qos:e}),this.is_connected()&&this.mqclient.subscribe(t,{qos:e})}},{key:"set_message_callback",value:function(t,e){this.subscribeCallbacks.set(t,e)}},{key:"is_connected",value:function(){return 1==this.mqclient.connected}},{key:"connect",value:function(t){var e,n,o=this,i="http:"==location.protocol?"ws":"wss";this.mqclient=S.connect(v()(e=v()(n="".concat(i,"://")).call(n,this.brokerHost,":")).call(e,this.brokerPort,"/mqtt"),t),this.mqclient.on("connect",(function(){var t;console.log(v()(t="成功连接到服务器[".concat(o.brokerHost,":")).call(t,o.brokerPort,"]"));for(var e=0;e<o.subscribeTopics.length;e++){var n=o.subscribeTopics[e];o.mqclient.subscribe(n.topic,{qos:n.qos})}})),this.mqclient.on("message",(function(t,e){o.mqclient,o.subscribeCallbacks.forEach((function(n,o){-1!=t.indexOf(o)&&n(t,e)}))})),this.mqclient.on("error",(function(t){}))}},{key:"publish",value:function(t,e,n){this.mqclient.publish(t,e,{qos:n,retain:!1})}}]),t}();new Array;function A(t){var e=function(){if("undefined"==typeof Reflect||!i.a)return!1;if(i.a.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(i()(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,o=f()(t);if(e){var a=f()(this).constructor;n=i()(o,arguments,a)}else n=o.apply(this,arguments);return h()(this,n)}}var C=function(t){u()(n,t);var e=A(n);function n(){var t,o;r()(this,n);for(var i=arguments.length,a=new Array(i),c=0;c<i;c++)a[c]=arguments[c];return(o=e.call.apply(e,v()(t=[this]).call(t,a))).state={loading:!0,count:0,dataSource:[],columns:[{title:"设备id",dataIndex:"objectId",key:"objectId"},{title:"设备名称",dataIndex:"name",key:"name"},{title:"设备地址",dataIndex:"devaddr",key:"devaddr"},{title:"ip地址",dataIndex:"ip"},{title:"设备状态",dataIndex:"status"},{title:"更新时间",dataIndex:"updatedAt"}]},o}return s()(n,[{key:"componentDidMount",value:function(){this.createkonva(),this.createMqtt()}},{key:"createMqtt",value:function(){var t,e,n,o,i,a,r,c=location,s=c.hostname,l=c.protocol,u={protocol:"http:"==l?"ws":"wss",url:s,port:"http:"==l?8083:8084};v()(t=v()(e="".concat(u.protocol,"://")).call(e,u.url,":")).call(t,u.port);n="admin",o="password",i="mqttx_aca65439",a=!1,(r=new P(u.url,u.port)).connect({userName:n,passWord:o,clientId:i,clean:a}),console.log(r),r.subscribe("/gb212/#",0)}},{key:"createkonva",value:function(){q.a.Node.create({attrs:{width:1262,height:440,id:"attrs"},className:"Stage",id:"attrs2",children:[{attrs:{},id:"Layer",className:"Layer",children:[{attrs:{x:200,y:200,sides:6,radius:70,fill:"red",stroke:"black",strokeWidth:4,id:"sides"},className:"RegularPolygon"}]}]},"dgiotKonva"),window.konva=q.a}},{key:"getData",value:function(){var t=this;this.setState({loading:!0}),g.c.get("".concat(w.a,"/iotapi/classes/Device"),{params:{limit:20,skip:0,order:"-createdAt",include:"product,name",where:{product:{$ne:null},name:{$ne:null,$exists:!0}}}}).then((function(e){t.setState({loading:!1}),t.setState({dataSource:e.results})})).finally((function(){return t.setState({loading:!1})}))}},{key:"render",value:function(){return m.a.createElement(y.Card,{bordered:!1},m.a.createElement("div",{id:"dgiotKonva"}))}}]),n}(k.Component);e.default=C}}]);