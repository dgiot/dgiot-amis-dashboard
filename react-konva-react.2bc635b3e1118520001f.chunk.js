/*!
 * build: 杭州数蛙科技有限公司 
 *  copyright: dgiot 
 *  project : dgiot-amis-dashboard 
 *  version : 0.0.2 
 *  description : dgiot-amis-dashboard 脚手架 
 *  author: h7ml(h7ml@qq.com) 
 *  time:Fri Apr 01 2022 12:04:20 GMT+0000 (Coordinated Universal Time)
 */
(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{1:function(t,e){},2:function(t,e){},3:function(t,e){},4:function(t,e){},rmrB:function(t,e,a){"use strict";a.r(e);var n=a("+EbZ"),i=a.n(n),o=a("06Pm"),s=a.n(o),r=a("kA7L"),c=a.n(r),l=a("X5/F"),u=a.n(l),d=a("3SUL"),h=a.n(d),p=a("eYnF"),v=a.n(p),f=(a("rB9j"),a("EnZy"),a("07d7"),a("5s+n"),a("p532"),a("SLhn")),b=a.n(f),k=a("cDcd"),g=a.n(k),m=a("Exp3"),y=a("4Iue"),w=a("Ni3L"),q=a("jWrc"),S=(a("FZtP"),a("kZKX")),x=a.n(S),N=a("5/y7"),I=function(){function t(e,a){s()(this,t),this.mqclient=void 0,this.brokerHost=void 0,this.brokerPort=void 0,this.subscribeTopics=void 0,this.subscribeCallbacks=void 0,this.brokerHost=e,this.brokerPort=a,this.subscribeTopics=new Array,this.subscribeCallbacks=new x.a}return c()(t,[{key:"subscribe",value:function(t,e){this.subscribeTopics.push({topic:t,qos:e}),this.is_connected()&&this.mqclient.subscribe(t,{qos:e})}},{key:"set_message_callback",value:function(t,e){this.subscribeCallbacks.set(t,e)}},{key:"is_connected",value:function(){return 1==this.mqclient.connected}},{key:"connect",value:function(t){var e,a,n=this,i="http:"==location.protocol?"ws":"wss";this.mqclient=N.connect(b()(e=b()(a="".concat(i,"://")).call(a,this.brokerHost,":")).call(e,this.brokerPort,"/mqtt"),t),this.mqclient.on("connect",(function(){var t;console.log(b()(t="成功连接到服务器[".concat(n.brokerHost,":")).call(t,n.brokerPort,"]"));for(var e=0;e<n.subscribeTopics.length;e++){var a=n.subscribeTopics[e];n.mqclient.subscribe(a.topic,{qos:a.qos})}})),this.mqclient.on("message",(function(t,e){n.mqclient,n.subscribeCallbacks.forEach((function(a,n){-1!=t.indexOf(n)&&a(t,e)}))})),this.mqclient.on("error",(function(t){}))}},{key:"publish",value:function(t,e,a){this.mqclient.publish(t,e,{qos:a,retain:!1})}}]),t}();new Array;function K(t){var e=function(){if("undefined"==typeof Reflect||!i.a)return!1;if(i.a.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(i()(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var a,n=v()(t);if(e){var o=v()(this).constructor;a=i()(n,arguments,o)}else a=n.apply(this,arguments);return h()(this,a)}}var L=q.a.getLogger("src/global.tsx"),P=function(t){u()(a,t);var e=K(a);function a(){var t,n;s()(this,a);for(var i=arguments.length,o=new Array(i),r=0;r<i;r++)o[r]=arguments[r];return(n=e.call.apply(e,b()(t=[this]).call(t,o))).state={loading:!0,count:0,dataSource:[],columns:[{title:"设备id",dataIndex:"objectId",key:"objectId"},{title:"设备名称",dataIndex:"name",key:"name"},{title:"设备地址",dataIndex:"devaddr",key:"devaddr"},{title:"ip地址",dataIndex:"ip"},{title:"设备状态",dataIndex:"status"},{title:"更新时间",dataIndex:"updatedAt"}]},n}return c()(a,[{key:"componentDidMount",value:function(){var t=location.hash,e={devaddr:t.split("/")[t.split("/").length-2],productid:t.split("/")[t.split("/").length-1]};this.getKonva(e),this.createkonva(),this.createMqtt(),this.getData()}},{key:"createMqtt",value:function(){var t,e,a,n,i,o,s,r=location,c=r.hostname,l=r.protocol,u={protocol:"http:"==l?"ws":"wss",url:c,port:"http:"==l?8083:8084};b()(t=b()(e="".concat(u.protocol,"://")).call(e,u.url,":")).call(t,u.port);a="admin",n="password",i="mqttx_aca65439",o=!1,(s=new I(u.url,u.port)).connect({userName:a,passWord:n,clientId:i,clean:o}),console.log(s),s.subscribe("/gb212/#",0)}},{key:"createkonva",value:function(){w.a.Node.create({attrs:{width:1262,height:440,id:"attrs"},className:"Stage",id:"attrs2",children:[{attrs:{},id:"Layer",className:"Layer",children:[{attrs:{x:200,y:200,sides:6,radius:70,fill:"red",stroke:"black",strokeWidth:4,id:"sides"},className:"RegularPolygon"}]}]},"dgiotKonva"),window.konva=w.a}},{key:"getKonva",value:function(t){var e=this;this.setState({loading:!0}),y.c.get("/iotapi/topo",{params:t}).then((function(t){var a=t.data;console.log("konva",a);var n={attrs:{width:1262,height:440,id:"attrs"},className:"Stage",id:"attrs2",children:[{attrs:{},id:"Layer",className:"Layer",children:[{attrs:{x:200,y:200,sides:6,radius:70,fill:"red",stroke:"black",strokeWidth:4,id:"sides"},className:"RegularPolygon"}]}]};w.a.Node.create(n,"dgiotKonva"),window.konva=w.a,e.initKonva(a.Stage||n),e.setState({loading:!1}),e.setState({dataSource:a})})).finally((function(){return e.setState({loading:!1})}))}},{key:"initKonva",value:function(t){w.a.Node.create(t,"dgiotKonva")}},{key:"getData",value:function(){var t=this;this.setState({loading:!0}),y.c.get("/iotapi/classes/Device",{params:{limit:20,skip:0,order:"-createdAt",include:"product,name",where:{product:{$ne:null},name:{$ne:null,$exists:!0}}}}).then((function(e){t.setState({loading:!1}),t.setState({dataSource:e.results})})).finally((function(){return t.setState({loading:!1})}))}},{key:"render",value:function(){var t=this.state.dataSource;return L.info("dataSource",t),g.a.createElement(m.Card,{bordered:!1},g.a.createElement("div",{id:"dgiotKonva"}))}}]),a}(k.Component);e.default=P}}]);